"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},utils=utils||{isArray:function(t){return t&&t.constructor===Array&&t instanceof Array},isObject:function(t){return t&&t.constructor===Object&&t instanceof Object},isFunction:function(t){return t&&"[object Function]"==={}.toString.call(t)},getNumberOfDifferentArrayKeys:function(t,e){var r=[],n=null;if(!t||!t.length)return 0;for(var i=0;i<t.length;i++)n=e?t[i][e]:t[i],n&&r.push(n);return d3.set(r).size()},sortBy:function(t,e){var r=Object.prototype.toString,n=function(t){return t},i=function(t){return n(null!==t&&"object"===("undefined"==typeof t?"undefined":_typeof(t))&&t[e.prop]||t)};return t instanceof Array&&t.length?("[object Object]"!==r.call(e)&&(e={}),"function"!=typeof e.parser&&(e.parser=n),e.desc=e.desc?-1:1,t.sort(function(t,r){return t=i.call(e,t),r=i.call(e,r),e.desc*(r>t?-1:+(t>r))})):[]}},utils=utils||{},doctype='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';!function(){function t(t){return t&&0==t.lastIndexOf("http",0)&&-1==t.lastIndexOf(window.location.host)}function e(e,r){var n=e.querySelectorAll("image"),i=n.length;0==i&&r();for(var a=0;a<n.length;a++)!function(e){var n=e.getAttribute("xlink:href");if(n&&t(n.value))return void console.warn("Cannot render embedded images linking to external hosts: "+n.value);var a=document.createElement("canvas"),o=a.getContext("2d"),s=new Image;n=n||e.getAttribute("href"),s.src=n,s.onload=function(){a.width=s.width,a.height=s.height,o.drawImage(s,0,0),e.setAttribute("xlink:href",a.toDataURL("image/png")),i--,0==i&&r()},s.onerror=function(){console.error("Could not load "+n),i--,0==i&&r()}}(n[a])}function r(e,r){for(var n="",i=document.styleSheets,a=0;a<i.length;a++)if(t(i[a].href))console.warn("Cannot include styles from other hosts: "+i[a].href);else{var o=i[a].cssRules;if(null!=o)for(var s=0;s<o.length;s++){var c=o[s];if("undefined"!=typeof c.style){var l=null;try{l=e.querySelector(c.selectorText)}catch(u){console.warn('Invalid CSS selector "'+c.selectorText+'"',u)}if(l){var h=r?r(c.selectorText):c.selectorText;n+=h+" { "+c.style.cssText+" }\n"}else c.cssText.match(/^@font-face/)&&(n+=c.cssText+"\n")}}}return n}utils.svgAsDataUri=function(t,n,i){n=n||{},n.scale=n.scale||1;var a="http://www.w3.org/2000/xmlns/";e(t,function(){var e,o,s=document.createElement("div"),c=t.cloneNode(!0);if("svg"==t.tagName)e=parseInt(c.getAttribute("width")||c.style.width||getComputedStyle(t).getPropertyValue("width")),o=parseInt(c.getAttribute("height")||c.style.height||getComputedStyle(t).getPropertyValue("height"));else{var l=t.getBBox();e=l.x+l.width,o=l.y+l.height,c.setAttribute("transform",c.getAttribute("transform").replace(/translate\(.*?\)/,""));var u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.appendChild(c),c=u}c.setAttribute("version","1.1"),c.setAttributeNS(a,"xmlns","http://www.w3.org/2000/svg"),c.setAttributeNS(a,"xmlns:xlink","http://www.w3.org/1999/xlink"),c.setAttribute("width",e*n.scale),c.setAttribute("height",o*n.scale),c.setAttribute("viewBox","0 0 "+e+" "+o),s.appendChild(c);var h=r(t,n.selectorRemap),f=document.createElement("style");f.setAttribute("type","text/css"),f.innerHTML="<![CDATA[\n"+h+"\n]]>";var p=document.createElement("defs");p.appendChild(f),c.insertBefore(p,c.firstChild);var u=doctype+s.innerHTML,d="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(u)));i&&i(d)})}}();var strategies={Barchart:function(t){return new SvgBarchartStrategy(t)},Linechart:function(t){return new SvgLinechartStrategy(t)},Streamgraph:function(t){return new SvgStreamgraphStrategy(t)}},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Colors=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"category1",value:function(){return d3.scale.ordinal().range(palette_category1)}},{key:"category2",value:function(){return d3.scale.ordinal().range(palette_category2)}},{key:"category3",value:function(){return d3.scale.ordinal().range(palette_category3)}},{key:"category4",value:function(){return d3.scale.ordinal().range(palette_category4)}},{key:"category5",value:function(){return d3.scale.ordinal().range(palette_category5)}},{key:"category6",value:function(){return d3.scale.ordinal().range(palette_category6)}},{key:"category7",value:function(){return d3.scale.ordinal().range(palette_category7)}},{key:"category8",value:function(){return d3.scale.ordinal().range(palette_category8)}}]),t}(),palette_category1=["#e1c8df","#9ecd9d","#acd9d6","#e4e36b","#bfa1c5","#e4d3b8","#facba8","#ced4ea","#acd9d6"],palette_category2=["#b6dde2","#6394af","#e4e9ab","#8ea876","#f7dce1","#cc878f","#fadaac","#f29a83","#8d7e9e"],palette_category3=["#6b68a9","#8cc590","#b9487d","#bfa1c5","#4e6936","#71bbc3","#484156","#ccaf44","#d0553c"],palette_category4=["#f1a30d","#1d4763","#84c7bc","#c1212d","#8fbe46","#076837","#563a2d","#563a2d","#87325d"],palette_category5=["#f1a30d","#0c3183","#acd9d6","#c1212d","#8fbe46","#076837","#8a6338","#8d2d84","#f09bbc"],palette_category6=["#71bbc3","#1d4763","#8fbe46","#4e6936","#ee8998","#c1212d","#f5af3c","#e95e2e","#634484"],palette_category7=["#ea671e","#684592","#84b92a","#cd131c","#3c5ba2","#5baddc","#ffde06","#5db68b","#775e47"],palette_category8=["#ebd646","#a50f38","#00a096","#f09bbc","#065b78","#72722a","#005231","#4d4e98","#7c4d25"],_default={Barchart:{style:{".axis":{font:"10px sans-serif"},".axis path,.axis line":{fill:"none",stroke:"#000","shape-rendering":"crispEdges"},".x.axis path":{display:"none"}},colorScale:Colors.category7(),margin:{top:20,right:20,bottom:30,left:50},width:600,height:250,ticks:5,tooltip:function(t){return"Info: "+JSON.stringify(t)},tickLabel:"",selector:"#chart",events:{down:function(){d3.select(this).classed("hover",!1)},over:function(){d3.select(this).transition().duration(150).attr("fill-opacity",.4)},leave:function(){d3.select(this).transition().duration(150).attr("fill-opacity",1)},click:function(t,e){console.log(t,e)}},transitionDuration:300,maxNumberOfElements:0,sortData:{descending:!1,prop:"x"}},Linechart:{selector:"#chart",margin:{top:20,right:20,bottom:30,left:50},width:600,height:250,style:{path:{stroke:"#11D3BC","stroke-width":2,fill:"none"},".axis":{font:"10px sans-serif"},".axis path,.axis line":{fill:"none",stroke:"#000","shape-rendering":"crispEdge"},".x.axis path":{display:"none"}},ticks:5,markers:{shape:"circle",size:5,color:"#FFFCCA",outlineColor:"#537780",outlineWidth:2},tooltip:function(t){return t},events:{down:function(){d3.select(this).classed("hover",!1)},over:function(){d3.select(this).transition().duration(50).attr("r",7)},leave:function(){d3.select(this).transition().duration(50).attr("r",5).style("stroke-width",2)},click:function(t,e){console.log(t,e)}},tickLabel:"",transitionDuration:300,maxNumberOfElements:0,sortData:{descending:!1,prop:"x"}},Streamgraph:{selector:"#chart",xDateFormat:"%m/%d/%y",colorScale:{from:"orange",to:"blue"},style:{".axis":{font:"10px sans-serif"},".axis path,.axis line":{fill:"none",stroke:"#000","shape-rendering":"crispEdges"}},margin:{top:20,right:20,bottom:30,left:50},width:900,height:300,ticks:5,tooltip:function(t){return"Info: "+JSON.stringify(t)},tickLabel:"",events:{down:function(){d3.select(this).classed("hover",!1)},over:function(){d3.select(this).transition().duration(150).attr("fill-opacity",.4)},leave:function(){d3.select(this).transition().duration(150).attr("fill-opacity",1)},click:function(t,e){console.log(t,e)}},transitionDuration:300,maxNumberOfElements:0,sortData:{descending:!1,prop:"x"}}},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),SvgStrategy=function(){function t(e){_classCallCheck(this,t),this.strategy=e}return _createClass(t,[{key:"draw",value:function(t){this.strategy.draw(t)}},{key:"on",value:function(t){this.strategy.on(t)}}]),t}(),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),SvgChart=function(){function t(e){_classCallCheck(this,t);var r=this.constructor.name;if("SvgChart"===r)throw new Error(r+" is non-instanciable");this._initialized=!1,this.cType=e.cType,this._loadConfigOnContext(e.config),this.interactiveElements=null}return _createClass(t,[{key:"draw",value:function(t){this._sortData&&utils.sortBy(t,{prop:this._sortData.prop,desc:this._sortData.descending}),this._initialized||this._initialize()}},{key:"_applyCSS",value:function(){var t=this.style,e=null;for(var r in t)e=t[r],d3.selectAll(r).style(e)}},{key:"on",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];for(var e in t){var r=t[e];this.interactiveElements.on(e+".user",r)}}},{key:"_loadConfigOnContext",value:function(t){this.margin=t.margin||_default[this.cType].margin,this.width=t.width||_default[this.cType].width,this.height=t.height||_default[this.cType].height,this.ticks=t.ticks||_default[this.cType].ticks,this.tickLabel=t.tickLabel||_default[this.cType].tickLabel,this.selector=t.selector||_default[this.cType].selector,this.transitionDuration=t.transitionDuration||_default[this.cType].transitionDuration,this.tooltip=t.tooltip||_default[this.cType].tooltip,this.events={},this.events.down=t.events.down||_default[this.cType].events.down,this.events.up=t.events.up||_default[this.cType].events.up,this.events.over=t.events.over||_default[this.cType].events.over,this.events.click=t.events.click||_default[this.cType].events.click,this.events.leave=t.events.leave||_default[this.cType].events.leave,this._sortData=t.sortData||_default[this.cType].sortData,this.style=t.style||_default[this.cType].style,this.colorScale=t.colorScale||_default[this.cType].colorScale}}]),t}(),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},SvgBarchartStrategy=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.xAxisName="x",r.yAxisName="y",r.x=d3.scale.ordinal().rangeRoundBands([0,r.width],.1),r.y=d3.scale.linear().range([r.height,0]),r.xAxis=d3.svg.axis().scale(r.x).orient("bottom").ticks(10),r.yAxis=d3.svg.axis().scale(r.y).orient("left").innerTickSize(-r.width).outerTickSize(0).tickPadding(20).ticks(r.ticks,r.tickLabel),r.keyFunction=function(t){return t.x},r}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(t){var r=this,n=null,i=Number.MIN_VALUE;_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t),this.x.domain(t.map(this.keyFunction)),i=d3.max(t,function(t){return t[r.yAxisName]}),this.y.domain([0,i]),this.svg.select(".x.axis").transition().duration(this.transitionDuration).call(this.xAxis),this.svg.select(".y.axis").transition().duration(this.transitionDuration).call(this.yAxis),n=this.svg.selectAll(".bar").data(t,this.keyFunction),n.enter().append("rect").attr("class","bar").attr("height",function(t){return r.height-r.y(t[r.yAxisName])}).attr("fill",function(t,e){return r.colorScale(e)}).on("mousedown.user",this.events.down).on("mouseup.user",this.events.up).on("mouseleave.user",this.events.leave).on("mouseover.user",this.events.over).on("click.user",this.events.click),this.interactiveElements=n,n.exit().transition().duration(300).attr("y",this.y(0)).attr("height",this.height-this.y(0)).style("fill-opacity",1e-6).style().remove(),n.transition().duration(300).attr("x",function(t){return r.x(t[r.xAxisName])}).attr("width",this.x.rangeBand()).attr("y",function(t){return r.y(t[r.yAxisName])}).attr("height",function(t){return r.height-r.y(t[r.yAxisName])}),this._applyCSS()}},{key:"_initialize",value:function(){var t=this.width+this.margin.left+this.margin.right,e=this.height+this.margin.left+this.margin.right;this.svg=d3.select(this.selector).append("svg").attr({width:t,height:e}).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").attr("stroke-dasharray","5, 5").call(this.yAxis).append("text"),this._initialized=!0}},{key:"_loadConfigOnContext",value:function(t){return t=t||{events:{}},t.events||(t.events={}),_get(Object.getPrototypeOf(e.prototype),"_loadConfigOnContext",this).call(this,t),this}}]),e}(SvgChart),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},SvgLinechartStrategy=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.xAxisName="x",r.yAxisName="y",r.x=d3.scale.linear().range([0,r.width]),r.y=d3.scale.linear().range([r.height,0]),r.xAxis=d3.svg.axis().scale(r.x).orient("bottom").ticks(10),r.yAxis=d3.svg.axis().scale(r.y).orient("left").innerTickSize(-r.width).outerTickSize(0).tickPadding(20).ticks(r.ticks,r.tickLabel),r.keyFunction=function(t){return t.x},r}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(t){var r=this,n=null,i=null,a=null;if(_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t),this.x.domain([d3.min(t,function(t){return t.x}),d3.max(t,function(t){return t.x})]),this.y.domain([0,d3.max(t,function(t){return t.y})]),this.svg.select(".x.axis").transition().duration(this.transitionDuration).call(this.xAxis),this.svg.select(".y.axis").transition().duration(this.transitionDuration).call(this.yAxis),n=d3.svg.line().x(function(t){return r.x(t.x)}).y(function(t){return r.y(t.y)}),i=this.svg.select("path").datum(t,this.keyFunction).attr("d",n),this.markers)switch(this.markers.shape){case"circle":a=this.svg.selectAll("circle").data(t,this.keyFunction),a.enter().append("circle").attr("cx",function(t){return r.x(t.x)}).attr("cy",function(t){return r.y(t.y)}).attr("r",this.markers.size).style({fill:this.markers.color,stroke:this.markers.outlineColor,"stroke-width":this.markers.outlineWidth}),a.transition().attr("cx",function(t){return r.x(t.x)}).attr("cy",function(t){return r.y(t.y)}).duration(0);break;default:throw Error("Not a valid marker shape: "+this.markers.shape)}this.tooltip&&a.append("title").text(this.tooltip(function(t){return r.x(t.x)})),a.on("mousedown.user",this.events.down).on("mouseup.user",this.events.up).on("mouseleave.user",this.events.leave).on("mouseover.user",this.events.over).on("click.user",this.events.click),this.interactiveElements=a,this._applyCSS()}},{key:"_initialize",value:function(){var t=this.width+this.margin.left+this.margin.right,e=this.height+this.margin.left+this.margin.right;this.svg=d3.select(this.selector).append("svg").attr({width:t,height:e}).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.append("path"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").attr("stroke-dasharray","5, 5").call(this.yAxis).append("text"),this._initialized=!0}},{key:"_loadConfigOnContext",value:function(t){return t=t||{events:{},markers:{}},t.events||(t.events={}),t.markers||(t.markers={}),_get(Object.getPrototypeOf(e.prototype),"_loadConfigOnContext",this).call(this,t),this.markers={},this.markers.color=t.markers.color||_default.Linechart.markers.color,this.markers.outlineColor=t.markers.outlineColor||_default.Linechart.markers.outlineColor,this.markers.outlineWidth=t.markers.outlineWidth||_default.Linechart.markers.outlineWidth,this.markers.shape=t.markers.shape||_default.Linechart.markers.shape,this.markers.size=t.markers.size||_default.Linechart.markers.size,this}}]),e}(SvgChart),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function r(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:r(a,e,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},SvgStreamgraphStrategy=function(t){function e(t){_classCallCheck(this,e);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return r.x=d3.time.scale().range([0,r.width]),r.y=d3.scale.linear().range([r.height-10,0]),r.format=d3.time.format(r.xDateformat),r.xAxis=d3.svg.axis().scale(r.x).orient("bottom").ticks(d3.time.days),r.yAxis=d3.svg.axis().scale(r.y),r}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(t){var e=this,r=null,n=null,i=this.colorScale.from,a=this.colorScale.to,o=null;this._initialized||this._initialize(),t.forEach(function(t){t.date=e.format.parse(t.date),t.value=+t.value}),this.stack=d3.layout.stack().offset("silhouette").values(function(t){return t.values}).x(function(t){return t.date}).y(function(t){return t.value}),this.nest=d3.nest().key(function(t){return t.key}),this.area=d3.svg.area().interpolate("cardinal").x(function(t){return e.x(t.date)}).y0(function(t){return e.y(t.y0)}).y1(function(t){return e.y(t.y0+t.y)}),r=this.stack(this.nest.entries(t)),this.x.domain(d3.extent(t,function(t){return t.date})),this.y.domain([0,d3.max(t,function(t){return t.y0+t.y})]),n=utils.getNumberOfDifferentArrayKeys(t,"key"),o=chroma.scale([i,a]).colors(n),this.z=d3.scale.ordinal().range(o),this.svg.selectAll(".layer").data(r).enter().append("path").attr("class","layer").attr("d",function(t){return e.area(t.values)}).style("fill",function(t,r){return e.z(r)}),this.svg.selectAll(".layer").attr("opacity",1).on("mousedown.user",this.events.down).on("mouseup.user",this.events.up).on("mouseleave.user",this.events.leave).on("mouseover.user",this.events.over).on("click.user",this.events.click);d3.select(this.selector).append("div").attr("class","remove").style("position","absolute").style("z-index","19").style("width","1px").style("height","380px").style("top","10px").style("bottom","30px").style("left","0px").style("background","#000000");this._applyCSS()}},{key:"_initialize",value:function(){var t=this.width+this.margin.left+this.margin.right,e=this.height+this.margin.left+this.margin.right;this.svg=d3.select(this.selector).append("svg").attr({width:t,height:e}).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.svg.append("g").attr("class","y axis").attr("transform","translate("+this.width+", 0)").call(this.yAxis.orient("right")),this.svg.append("g").attr("class","y axis").call(this.yAxis.orient("left")),this._initialized=!0}},{key:"_loadConfigOnContext",value:function(t){t=t||{events:{}},t.events||(t.events={}),_get(Object.getPrototypeOf(e.prototype),"_loadConfigOnContext",this).call(this,t),this.colorScale=t.colorScale||_default.Streamgraph.colorScale,this.xDateformat=t.xDateFormat||_default.Streamgraph.xDateFormat}}]),e}(SvgChart),_get=function n(t,e,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var a=Object.getPrototypeOf(t);return null===a?void 0:n(a,e,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),Chart=function(){function t(){_classCallCheck(this,t);var e=this.constructor.name;if("Chart"===e||"Basic"===e||"Flow"===e)throw new Error(e+" is non-instanciable");this.events={}}return _createClass(t,[{key:"_getChartContext",value:function(){return{data:this.data,config:this.config,cType:this.constructor.name}}},{key:"_initializeSVGContext",value:function(){this._svg=new SvgStrategy(strategies[this.constructor.name](this._getChartContext()))}},{key:"_inferDataSource",value:function(t){if(utils.isObject(t))this._initializeWebsocketDataSource(t);else if(!utils.isArray(t))throw new TypeError("Wrong data format")}},{key:"_initializeWebsocketDataSource",value:function(t){var e=this,r=function(){e.ws=new WebSocket(t.endpoint),e.ws.onopen=function(){},e.ws.onerror=function(t){throw new Error("Error with websocket connection",t)},e.ws.onmessage=function(t){var r=JSON.parse(t.data.substr(2))[1];setTimeout(function(){e.keepDrawing(r)},50)}};this.start=function(){r()},this.stop=function(){e.ws&&e.ws.close()}}},{key:"addSerie",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(!t||!utils.isObject(t))throw Error("'serie' should be an object. Instead: "+series);this.data.push(t),e&&this.draw()}},{key:"addSeries",value:function(t){var e=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];if(!t||t.constructor!==Array)throw Error("'series' should be an array. Instead: "+t);this.data=this.data.concat(t),e&&this.draw()}},{key:"draw",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];if(!utils.isArray(t))throw new TypeError("draw method is only allowed with static data.");this._svg.draw(t)}},{key:"toPNG",value:function(t){utils.svgAsDataUri(d3.select(this.config.selector+" svg")[0][0],{},function(e,r){if(r)throw Error("Error converting to image "+r);t(e)})}},{key:"on",value:function(t,e){if(!t||"string"!=typeof t)throw Error("eventName should be a string. Instead: "+t);if(!e||!utils.isFunction(e))throw Error("action should be a function. Instead: "+t);return this.events[t]=e,this._svg.on(this.events),this}}]),t}(),Basic=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this))}return _inherits(e,t),e}(Chart),Flow=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this))}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(t){t=JSON.parse(JSON.stringify(t)),_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t)}}]),e}(Chart),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function i(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:i(a,e,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},Barchart=function(t){function e(t,r){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));if(!arguments.length)throw new Error("Missing constructor parameters");switch(n._inferDataSource(arguments[0]),arguments.length){case 1:n.data=arguments[0],n.config=_default[n.constructor.name];break;case 2:n.data=arguments[0],n.config=arguments[1];break;default:throw Error("Unrecognized number of paremeters: "+arguments)}return n._initializeSVGContext(),n}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t)}},{key:"keepDrawing",value:function(t){var r=this.config,n=r.maxNumberOfElements;if(this.datum||(this.datum=[]),this.datum=this.datum.concat(t),n&&n>0&&this.datum.length>n)for(var i=0;i<t.length;i++)this.datum.shift();_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,this.datum)}}]),e}(Basic),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function a(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:a(i,e,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},Linechart=function(t){function e(t,r){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));if(!arguments.length)throw new Error("Missing constructor parameters");switch(n._inferDataSource(arguments[0]),arguments.length){case 1:n.data=arguments[0],n.config=_default[n.constructor.name];break;case 2:n.data=arguments[0],n.config=arguments[1];break;default:throw Error("Unrecognized number of paremeters: "+arguments)}return n._initializeSVGContext(),n}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t)}},{key:"keepDrawing",value:function(t){var r=this.config,n=r.maxNumberOfElements;if(this.datum||(this.datum=[]),this.datum=this.datum.concat(t),n&&n>0&&this.datum.length>n)for(var i=0;i<t.length;i++)this.datum.shift();_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,this.datum)}}]),e}(Basic),_createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),_get=function o(t,e,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:o(i,e,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},Streamgraph=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this));if(!arguments.length)throw new Error("Missing constructor parameters");switch(t._inferDataSource(arguments[0]),arguments.length){
case 1:t.data=arguments[0],t.config=_default;break;case 2:t.data=arguments[0],t.config=arguments[1];break;default:throw Error("Unrecognized number of paremeters: "+arguments)}return t._initializeSVGContext(),t}return _inherits(e,t),_createClass(e,[{key:"draw",value:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,t)}},{key:"keepDrawing",value:function(t){this.datum||(this.datum=[]),this.datum=this.datum.concat(t),_get(Object.getPrototypeOf(e.prototype),"draw",this).call(this,this.datum)}}]),e}(Flow);